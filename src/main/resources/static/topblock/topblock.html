<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>主线板块展示</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    <style>
        .card-header {
            font-weight: bold;
        }

        .chart-container {
            padding: 10px;
        }
    </style>
</head>
<body>
<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>主线板块展示</h2>
        <div>
            <label for="blockNewId">选择板块类型:</label>
            <select id="blockNewId" onchange="loadData()">
                <option value="1">百日新高</option>
                <option value="2">涨幅榜</option>
                <option value="3">RPS三线红</option>
                <option value="4">二阶段</option>
                <option value="5">均线大多头</option>
                <option value="6">板块AMO-TOP1</option>
            </select>

            <label for="date">选择日期:</label>
            <input type="date" id="date" onchange="loadData()">

            <label for="N">近N天:</label>
            <input type="number" id="N" value="15" min="1" onchange="loadData()">

            <label for="resultType">结果类型:</label>
            <select id="resultType" onchange="loadData()">
                <option value="2">普通行业（LV2）</option>
                <option value="4">概念板块（LV3）</option>
                <option value="12">研究行业（LV1）</option>
            </select>
        </div>
    </div>

    <!-- 百日新高 -->
    <div class="card mb-4">
        <div class="card-header">百日新高 - 天数分布</div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div id="chart1_2" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <div id="chart1_4" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <div id="chart1_12" style="width: 100%; height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 涨幅榜 -->
    <div class="card mb-4">
        <div class="card-header">涨幅榜 - 天数分布</div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div id="chart2_2" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <div id="chart2_4" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <div id="chart2_12" style="width: 100%; height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- RPS三线红 -->
    <div class="card mb-4">
        <div class="card-header">RPS三线红 - 天数分布</div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div id="chart3_2" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <div id="chart3_4" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <div id="chart3_12" style="width: 100%; height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 二阶段 -->
    <div class="card mb-4">
        <div class="card-header">二阶段 - 天数分布</div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div id="chart4_2" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <div id="chart4_4" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <div id="chart4_12" style="width: 100%; height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 均线大多头 -->
    <div class="card mb-4">
        <div class="card-header">均线大多头 - 天数分布</div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div id="chart5_2" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <div id="chart5_4" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <div id="chart5_12" style="width: 100%; height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 板块AMO-TOP1 -->
    <div class="card mb-4">
        <div class="card-header">板块AMO-TOP1 - 天数分布</div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div id="chart6_2" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <div id="chart6_4" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="col-md-4">
                    <div id="chart6_12" style="width: 100%; height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    const chartIds = [
        'chart1_2', 'chart1_4', 'chart1_12',
        'chart2_2', 'chart2_4', 'chart2_12',
        'chart3_2', 'chart3_4', 'chart3_12',
        'chart4_2', 'chart4_4', 'chart4_12',
        'chart5_2', 'chart5_4', 'chart5_12',
        'chart6_2', 'chart6_4', 'chart6_12'
    ];
    const blockNewIds = [
        1, 1, 1,
        2, 2, 2,
        3, 3, 3,
        4, 4, 4,
        5, 5, 5,
        6, 6, 6
    ];
    const resultTypes = [
        2, 4, 12,
        2, 4, 12,
        2, 4, 12,
        2, 4, 12,
        2, 4, 12,
        2, 4, 12
    ];
    const charts = {};

    function loadData() {
        const date = document.getElementById('date').value;
        const N = document.getElementById('N').value;

        blockNewIds.forEach((blockNewId, index) => {
            let resultType = resultTypes[index];

            fetch(`/api/topBlock/rate?blockNewId=${blockNewId}&date=${date}&N=${N}&resultType=${resultType}`)
                .then(res => res.json())
                .then(data => {
                    if (!data.success) {
                        console.error('加载失败:', data.msg);
                        return;
                    }

                    const chartData = Object.entries(data.data).map(([key, value]) => ({
                        name: key.split('-')[1],
                        value: value
                    }));

                    const option = {
                        title: {
                            text: `${getResultTypeName(resultType)}`,
                            left: 'center',
                            bottom: '5%' // 将标题位置移到底部
                        },
                        tooltip: {
                            trigger: 'item'
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'left'
                        },
                        series: [
                            {
                                name: '天数',
                                type: 'pie',
                                radius: '50%',
                                data: chartData,
                                emphasis: {
                                    itemStyle: {
                                        shadowBlur: 10,
                                        shadowOffsetX: 0,
                                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                                    }
                                }
                            }
                        ]
                    };

                    charts[chartIds[index]].setOption(option);
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                });
        });
    }

    function getBlockNewIdName(id) {
        switch (id) {
            case 1:
                return '百日新高';
            case 2:
                return '涨幅榜';
            case 3:
                return 'RPS三线红';
            case 4:
                return '二阶段';
            case 5:
                return '均线大多头';
            case 6:
                return '板块AMO-TOP1';
            default:
                return '未知';
        }
    }

    function getResultTypeName(id) {
        switch (id) {
            case 2:
                return '普通行业（LV2）';
            case 4:
                return '概念板块（LV3）';
            case 12:
                return '研究行业（LV1）';
            default:
                return '';
        }
    }

    window.onload = () => {

        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date').value = today;

        chartIds.forEach(id => {
            charts[id] = echarts.init(document.getElementById(id));
        });

        loadData();
    };
</script>
</body>
</html>